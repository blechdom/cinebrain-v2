{"version":3,"sources":["webpack:///./server/index.js?d43f"],"names":["install","atem1me","atemTV1","atemTV2","connect","midiOutA","appModule","require","db","server","websocket","UDPserver","UDPclient","PTZ_init","Buffer","from","PTZ_network_setting","PTZ_change_IP_Enquiry","PTZ_change_IP","PTZ_camera_on","PTZ_camera_off","then","connection","createServer","setDb","on","app","listen","console","log","current_universe_buffer","dmx_usb_pro","current_universe","collection","err","findOne","_id","dmx_data","result","JSON","stringify","data","createSocket","stack","close","msg","rinfo","address","port","bind","socket","id","host","command","runTelnet","message","changeProgramInput","changePreviewInput","changeTransitionPosition","autoTransition","changeTransitionType","atem1md","runMacro","sockets","emit","buffer","update","dmx","offset","universe","updated_dmx","save","parse","toString","updateAll","instrument_id","preset_num","dmx_offset","upsert","DMXArray","DMXObject","indexString","indexNum","i","len","length","UDPmessage","send","controller","value","channel","number","telnetHost","telnetPort","params","timeout","negotiationMandatory","ors","waitfor","res","trim","telnetResponse","catch","error","module","hot","accept","removeListener"],"mappings":"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","file":"0.4a92de4848fa7fc7f593.hot-update.js","sourcesContent":["import SourceMapSupport from 'source-map-support';\r\nSourceMapSupport.install();\r\nimport 'babel-polyfill';\r\nimport http from 'http';\r\nimport { MongoClient } from 'mongodb';\r\nimport socketio from 'socket.io';\r\nimport telnet from 'telnet-client';\r\nimport DMX from './dmx_usb_pro.js';\r\nimport dgram from 'dgram';\r\nimport emptyFunction from 'fbjs/lib/emptyFunction';\r\nimport ATEM from 'applest-atem/lib/atem.js';\r\nimport easymidi from 'easymidi/index.js';\r\n\r\nlet atem1me = new ATEM();\r\nlet atemTV1 = new ATEM();\r\nlet atemTV2 = new ATEM();\r\n\r\n//atem1me.connect('192.168.10.240');\r\natemTV1.connect('192.168.10.240');\r\n//atemTV2.connect('192.168.10.242');\r\nvar midiOutA;\r\n//var midiOutA = new easymidi.Output('MIDIPLUS TBOX 2x2 1');\r\n\r\nlet appModule = require('./server.js');\r\nlet db;\r\nlet server;\r\nlet websocket;\r\nlet UDPserver;\r\nlet UDPclient;\r\n\r\nconst PTZ_init = Buffer.from('020000010000000001', 'hex');\r\nconst PTZ_network_setting = Buffer.from('02045d4b9d2eceff1921680102ff255255255000ffrobocam2ff03', 'hex');\r\nconst PTZ_change_IP_Enquiry = Buffer.from('02454e513a6e6574776f726b03ff', 'hex');\r\nconst PTZ_change_IP = Buffer.from('024d41433a30342d35642d34622d39642d32652d6365FF49504144523a3139322e3136382e31302e323030FF4d41534b3a3235352e3235352e302e30FF4e414d453a43414d4552413031FF03', 'hex');\r\nconst PTZ_camera_on = Buffer.from('010000060000000c8101040002ff', 'hex');\r\nconst PTZ_camera_off = Buffer.from('010000060000000c8101040003ff', 'hex');\r\n\r\n//atemTV1.on('connect', function() {     \r\n \r\nMongoClient.connect('mongodb://localhost/cinebrain').then(connection => {\r\n  db = connection;\r\n  server = http.createServer();\r\n  appModule.setDb(db);\r\n  server.on('request', appModule.app);\r\n  server.listen(80, () => {\r\n    console.log('App started on port 80');\r\n  });\r\n\r\n\r\n  let current_universe_buffer = new Buffer(512);\r\n  let dmx_usb_pro, current_universe;\r\n\r\n  db.collection('last_known_universe', function (err, collection) {\r\n    collection.findOne({ _id: \"last_known_universe\" }, { dmx_data: 1, _id:0 }, function (err, result) {\r\n      console.log(\"result \" + JSON.stringify(result));\r\n      current_universe = result.dmx_data; \r\n      console.log(\"current_universe is \" + JSON.stringify(current_universe.data));\r\n      current_universe_buffer = Buffer(current_universe.data);\r\n      dmx_usb_pro = new DMX('COM3', current_universe_buffer);\r\n    });\r\n  });\r\n   \r\n   //dmx_usb_pro = new DMX('COM3', current_universe);\r\n\r\n  UDPserver = dgram.createSocket('udp4');\r\n  UDPclient = dgram.createSocket('udp4');\r\n\r\n  UDPserver.on('error', (err) => {\r\n  console.log(`UDP server error:\\n${err.stack}`);\r\n  UDPserver.close();\r\n  });\r\n\r\n  UDPserver.on('message', (msg, rinfo) => {\r\n    console.log(`UDP server got: ${msg} from ${rinfo.address}:${rinfo.port}`);\r\n  });\r\n\r\n  UDPserver.on('listening', () => {\r\n    const address = '192.168.10.101';\r\n    console.log(`UDP server listening ${address.address}:${address.port}`);\r\n  });\r\n\r\n  /*UDPclient.send(PTZ_init, 52381, '192.168.0.100', (err) => {\r\n    console.log(\"send message \" + PTZ_init + \" err: \" + err);\r\n    UDPclient.send(PTZ_camera_on, 52381, '192.168.0.100', (err) => {\r\n      console.log(\"send message \" + PTZ_camera_on + \" err: \" + err);\r\n    });\r\n  });\r\n*/\r\n /* UDPclient.send(PTZ_network_setting, 52380, '192.168.0.100', (err) => {\r\n    console.log(\"send message err: \" + err);\r\n  });\r\n*/\r\n  UDPserver.bind(62455);\r\n\r\n  websocket = socketio(server);\r\n  websocket.on('connection', (socket) => {\r\n   \r\n        console.log(\"user connected from: \" + socket.id);\r\n\r\n        socket.on('disconnect', () => {\r\n                console.log('user disconnected')\r\n        });\r\n        socket.on('diagnostics-send-telnet', function(data) {\r\n                console.log(\"received telnet command: \" + data.host + \":\" + data.port + \"-->\" + data.command);\r\n                runTelnet(data.host, data.port, data.command);\r\n        });\r\n        socket.on('control-interface-send-telnet', function(data) {\r\n                console.log(\"received telnet command: \" + data.host + \":\" + data.port + \"-->\" + data.command);\r\n                runTelnet(data.host, data.port, data.command);\r\n        });\r\n        socket.on('atem1me_changeProgramInput', (message) => {\r\n                console.log(\"received atem 1 m/e program input command: \" + message);\r\n                atem1me.changeProgramInput(message);\r\n        });\r\n        socket.on('atem1me_changePreviewInput', (message) => {\r\n                console.log(\"received atem 1 m/e preview input command: \" + message);\r\n                atem1me.changePreviewInput(message);\r\n        });\r\n        socket.on('atemTV1_changeProgramInput', (message) => {\r\n                console.log(\"received atem TV 1 program input command: \" + message);\r\n                atemTV1.changeProgramInput(message);\r\n        });\r\n        socket.on('atemTV1_changePreviewInput', (message) => {\r\n                console.log(\"received atem TV 1 preview input command: \" + message);\r\n                atemTV1.changePreviewInput(message);\r\n        });\r\n        socket.on('atemTV1_transition_position', (message) => {\r\n                console.log(\"received atem TV 1 preview input command: \" + message);\r\n                atemTV1.changeTransitionPosition(message);\r\n        });\r\n         socket.on('atemTV1_autoTransition', (message) => {\r\n                console.log(\"received atem TV 1 preview input command: \" + message);\r\n                atemTV1.autoTransition();\r\n        });\r\n          socket.on('atemTV1_transitionType', (message) => {\r\n                console.log(\"received atem TV 1 preview input command: \" + message);\r\n                atemTV1.changeTransitionType(message);\r\n        });\r\n        socket.on('atemTV2_changeProgramInput', (message) => {\r\n                console.log(\"received atem TV 2 program input command: \" + message);\r\n                atemTV2.changeProgramInput(message);\r\n        });\r\n        socket.on('atemTV2_changePreviewInput', (message) => {\r\n                console.log(\"received atem TV 2 preview input command: \" + message);\r\n                atemTV2.changePreviewInput(message);\r\n        });\r\n         socket.on('atem1me_runMacro', (message) => {\r\n                console.log(\"received atem 1 m/e preview input command: \" + message);\r\n                    atem1md.runMacro(2);\r\n                    atem1me.runMacro(message);\r\n        });\r\n        socket.on('device-menu', (message) => {\r\n            console.log(\"the device number is: \" + message);\r\n            websocket.sockets.emit(\"show-parameters\", message);\r\n        });\r\n        socket.on('parameter-menu', (buffer) => {\r\n                console.log(\"the parameter packet is: \" + buffer);\r\n                websocket.sockets.emit(\"show-parameter-inputs\", buffer);\r\n        }); \r\n        socket.on('dmx-go', (buffer) => {\r\n                dmx_usb_pro.update(buffer.dmx, buffer.offset);\r\n                console.log(\"dmx-go: \" + JSON.stringify(buffer.dmx));\r\n                console.log(\"dmx_usb_pro: \" + JSON.stringify(dmx_usb_pro.universe));\r\n                let updated_dmx = JSON.stringify(dmx_usb_pro.universe);\r\n                db.collection('last_known_universe').save({_id:\"last_known_universe\", dmx_data:JSON.parse(updated_dmx.toString())});\r\n        });     \r\n        socket.on('dmx-all', (buffer) => {\r\n                dmx_usb_pro.updateAll(buffer);\r\n        });\r\n        socket.on('dmx-save-preset', (data) => {\r\n          db.collection('dmx_presets').update({instrument_id:data.instrument_id, preset_num: data.preset_num, dmx_offset: data.dmx_offset}, data, {upsert: true});\r\n        }); \r\n        socket.on('dmx-load-preset', (data) => {\r\n        \r\n          db.collection('dmx_presets', function (err, collection) {\r\n            collection.findOne({instrument_id: data.instrument_id, preset_num: data.preset_num, dmx_offset: data.dmx_offset}, function (err, result) {\r\n                console.log(\"result \" + JSON.stringify(result.dmx_data));\r\n                socket.emit('dmx-load-preset-data', result.dmx_data);\r\n                let DMXArray = result.dmx_data;\r\n                let DMXObject = {};\r\n                let indexString, indexNum;\r\n                for (var i = 0, len = DMXArray.length; i < len; i++) {\r\n                  indexNum = i+result.dmx_offset;\r\n                  console.log(\"indexNum \" + indexNum);\r\n                  indexString = indexNum.toString();\r\n                  console.log(\"indexString \" + indexString);\r\n                  DMXObject.indexString = DMXArray[i];\r\n                  console.log(\"array point \" + DMXArray[i] + \" DMXObject \" + DMXObject.indexString);\r\n                }\r\n                console.log(\"DMXArray \" + DMXArray);\r\n                console.log(\"DMXObject \" + JSON.stringify(DMXObject));\r\n\r\n            });\r\n          });\r\n\r\n\r\n        });  \r\n        socket.on('ptz-go', function(data) {\r\n                let UDPmessage = Buffer.from(data.buffer, 'hex');\r\n                UDPclient.send(PTZ_init, data.port, data.host, (err) => {\r\n                  UDPclient.send(UDPmessage, data.port, data.host, (err) => {\r\n                  console.log(\"send message \" + data.buffer + \" err: \" + err);\r\n                  });\r\n                });\r\n        });     \r\n        socket.on('midi-cc', function(data) {\r\n              midiOutA.send('cc', {\r\n                controller: data.controller,\r\n                value: data.value,\r\n                channel: data.channel\r\n              });\r\n        });\r\n        socket.on('midi-program', function(data) {\r\n              midiOutA.send('program', {\r\n                number: data.number,\r\n                channel: data.channel\r\n              });\r\n        });\r\n\r\n        const telnetHost = '127.0.0.1';\r\n        const telnetPort = 5250;\r\n\r\n        function runTelnet(telnetHost, telnetPort, command) {\r\n          var connection = new telnet();\r\n\r\n          var params = {\r\n              host: telnetHost,\r\n              port: telnetPort,\r\n              timeout: 1500,\r\n              negotiationMandatory: false,\r\n              ors: '\\r\\n', \r\n              waitfor: '\\n'  \r\n          };\r\n          connection.on('connect', function() {\r\n              connection.send(command, function(err, res) {\r\n                  if (err) return err\r\n\r\n                  console.log('first message:', res.trim())\r\n\r\n                  telnetResponse(res);\r\n\r\n                  connection.send('', {\r\n                      ors: '\\r\\n',\r\n                      waitfor: '\\n'\r\n                  }, function(err, res) {\r\n                    if (err) return err\r\n\r\n                      console.log('resp after cmd:', res)\r\n                  })\r\n              })\r\n          })\r\n\r\n          connection.connect(params)\r\n        }\r\n\r\n        function telnetResponse (res) {\r\n          websocket.sockets.emit(\"telnet-response\", res);\r\n        }\r\n  });\r\n \r\n}).catch(error => {\r\n  console.log('ERROR:', error);\r\n});\r\n\r\n//});\r\n\r\nif (module.hot) {\r\n  module.hot.accept('./server.js', () => {\r\n    server.removeListener('request', appModule.app);\r\n    appModule = require('./server.js');     // eslint-disable-line\r\n    appModule.setDb(db);\r\n    server.on('request', appModule.app);\r\n  });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}
{"version":3,"sources":["webpack:///./server/dmx_usb_pro.js?20e1"],"names":["SerialPort","require","ENTTEC_PRO_DMX_STARTCODE","ENTTEC_PRO_START_OF_MSG","ENTTEC_PRO_END_OF_MSG","ENTTEC_PRO_SEND_DMX_RQ","ENTTEC_PRO_RECV_DMX_PKT","DMX","device_id","current_universe","console","log","self","universe","dev","err","JSON","stringify","prototype","send_universe","isOpen","hdr","Buffer","length","msg","concat","write","close","cb","update","u","c","updateAll","v","i","universeToObject","get","module","exports"],"mappings":"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","file":"0.3cd57d3b474636c57be0.hot-update.js","sourcesContent":["\"use strict\"\r\n\r\nvar SerialPort = require(\"serialport\")\r\n\r\nvar\t  ENTTEC_PRO_DMX_STARTCODE = 0x00\r\n\t, ENTTEC_PRO_START_OF_MSG  = 0x7e\r\n\t, ENTTEC_PRO_END_OF_MSG    = 0xe7\r\n\t, ENTTEC_PRO_SEND_DMX_RQ   = 0x06\r\n\t, ENTTEC_PRO_RECV_DMX_PKT  = 0x05\r\n\t;\r\n\r\nfunction DMX(device_id, current_universe) {\r\n\tconsole.log(\"initalizing dmx usb pro...\");\r\n\tvar self = this\r\n\tthis.universe = current_universe;\r\n\r\n\tthis.dev = new SerialPort(device_id, {\r\n\t\t'baudrate': 250000,\r\n\t\t'databits': 8,\r\n\t\t'stopbits': 2,\r\n\t\t'parity': 'none'\r\n\t}, function(err) {\r\n\t\tconsole.log(\"dmx enttec driver device error\");\r\n\t})\r\n\tconsole.log(\"in driver: this.dev: \" + JSON.stringify(this.dev));\r\n}\r\n\r\nDMX.prototype.send_universe = function() {\r\n\tif(!this.dev.isOpen()) {\r\n\t\tconsole.log(\"dmx usb pro device is NOT open\");\r\n\t\treturn\r\n\t}\r\n\tvar hdr = Buffer([\r\n\t\tENTTEC_PRO_START_OF_MSG,\r\n\t\tENTTEC_PRO_SEND_DMX_RQ,\r\n\t\t (this.universe.length + 1)       & 0xff,\r\n\t\t((this.universe.length + 1) >> 8) & 0xff,\r\n\t\tENTTEC_PRO_DMX_STARTCODE\r\n\t])\r\n\tvar msg = Buffer.concat([\r\n\t\thdr,\r\n\t\tthis.universe,\r\n\t\tBuffer([ENTTEC_PRO_END_OF_MSG])\r\n\t])\r\n\tthis.dev.write(msg)\r\n}\r\n\r\nDMX.prototype.close = function(cb) {\r\n\tconsole.log(\"closing DMX USB PRO device... \" + cb);\r\n\tthis.dev.close(cb)\r\n}\r\n\r\nDMX.prototype.update = function(u) {\r\n\tconsole.log(\"update universe to be \" + this.universe + \" and channels are \" + u);\r\n\tfor(var c in u) {\r\n\t\tthis.universe[c] = u[c]\r\n\t\tconsole.log(\"c: \" + c + \" u: \" + JSON.stringify(u));\r\n\t}\r\n\tthis.send_universe()\r\n}\r\n\r\nDMX.prototype.updateAll = function(v) {\r\n\tfor(var i = 0; i < 512; i++) {\r\n\t\tthis.universe[i] = v\r\n\t}\r\n\tthis.send_universe()\r\n}\r\n\r\nDMX.prototype.universeToObject = function() {\r\n\tvar u = {}\r\n\tfor(var i = 0; i < this.universe.length; i++) {\r\n\t\tu[i] = this.get(i)\r\n\t}\r\n\treturn u\r\n}\r\n\r\nDMX.prototype.get = function(c) {\r\n\treturn this.universe[c]\r\n}\r\n\r\nmodule.exports = DMX\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/dmx_usb_pro.js"],"sourceRoot":""}
{"version":3,"sources":["webpack:///./server/dmx_usb_pro.js?20e1"],"names":["util","require","EventEmitter","SerialPort","console","log","DMX","device_id","self","universe","Buffer","dev","err","JSON","stringify","inherits","prototype","update","channels","updateDMX","emit","updateAll","value","updateAllDMX","universeToObject","u","i","length","get","ENTTEC_PRO_DMX_STARTCODE","ENTTEC_PRO_START_OF_MSG","ENTTEC_PRO_END_OF_MSG","ENTTEC_PRO_SEND_DMX_RQ","ENTTEC_PRO_RECV_DMX_PKT","send_universe","isOpen","hdr","msg","concat","write","start","stop","close","cb","c","v","module","exports"],"mappings":"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","file":"0.8888f011636d8476f061.hot-update.js","sourcesContent":["\"use strict\"\r\n\r\nvar util = require('util')\r\nvar EventEmitter = require('events').EventEmitter;\r\nvar SerialPort = require(\"serialport\")\r\n//var dmx_usb_pro = require('./drivers/enttec-usb-dmx-pro');\r\nconsole.log(\"dmx usb pro library loaded\");\r\n\r\nfunction DMX(device_id) {\r\n\tvar self = this\r\n\tconsole.log(\"initalize dmx usb pro\");\r\n\tthis.universe = {};\r\n\t//return this.universe = new dmx_usb_pro(device_id)\r\n\r\n\t//options = options || {}\r\n\treturn this.universe = new Buffer(512)\r\n\t\r\n\tthis.dev = new SerialPort(device_id, {\r\n\t\t'baudrate': 250000,\r\n\t\t'databits': 8,\r\n\t\t'stopbits': 2,\r\n\t\t'parity': 'none'\r\n\t}, function(err) {\r\n\t\tconsole.log(\"dmx enttec driver device error\");\r\n\t})\r\n\tconsole.log(\"in driver: this.dev: \" + JSON.stringify(this.dev));\r\n\t//this.universe = {};\r\n}\r\n\r\nutil.inherits(DMX, EventEmitter)\r\n\r\n\r\nDMX.prototype.update = function(universe, channels) {\r\n\tconsole.log(\"update universe to be \" + universe + \" and channels are \" + channels);\r\n\tthis.universe.updateDMX(channels)\r\n\tthis.emit('update', universe, channels)\r\n}\r\n\r\nDMX.prototype.updateAll = function(universe, value) {\r\n\tthis.universe.updateAllDMX(value)\r\n\tthis.emit('updateAll', universe, value)\r\n}\r\n\r\nDMX.prototype.universeToObject = function(universe) {\r\n\t//var universe = this.universe\r\n\tvar u = {}\r\n\tfor(var i = 0; i < this.universe.length; i++) {\r\n\t\tu[i] = this.universe.get(i)\r\n\t}\r\n\treturn u\r\n}\r\n\r\nvar\t  ENTTEC_PRO_DMX_STARTCODE = 0x00\r\n\t, ENTTEC_PRO_START_OF_MSG  = 0x7e\r\n\t, ENTTEC_PRO_END_OF_MSG    = 0xe7\r\n\t, ENTTEC_PRO_SEND_DMX_RQ   = 0x06\r\n\t, ENTTEC_PRO_RECV_DMX_PKT  = 0x05\r\n\t;\r\n/*\r\nfunction EnttecUSBDMXPRO(device_id, options) {\r\n\tvar self = this\r\n\toptions = options || {}\r\n\tthis.universe = new Buffer(512)\r\n\t\r\n\tthis.dev = new SerialPort(device_id, {\r\n\t\t'baudrate': 250000,\r\n\t\t'databits': 8,\r\n\t\t'stopbits': 2,\r\n\t\t'parity': 'none'\r\n\t}, function(err) {\r\n\t\tconsole.log(\"dmx enttec driver device error\");\r\n\t})\r\n\tconsole.log(\"in driver: this.dev: \" + JSON.stringify(this.dev));\r\n}\r\n*/\r\nDMX.prototype.send_universe = function() {\r\n\tif(!this.dev.isOpen()) {\r\n\t\tconsole.log(\"in driver, this.dev is NOT open\");\r\n\t\treturn\r\n\t}\r\n\tvar hdr = Buffer([\r\n\t\tENTTEC_PRO_START_OF_MSG,\r\n\t\tENTTEC_PRO_SEND_DMX_RQ,\r\n\t\t (this.universe.length + 1)       & 0xff,\r\n\t\t((this.universe.length + 1) >> 8) & 0xff,\r\n\t\tENTTEC_PRO_DMX_STARTCODE\r\n\t])\r\n\tconsole.log(\"in driver hdr: \" + JSON.stringify(hdr));\r\n\tvar msg = Buffer.concat([\r\n\t\thdr,\r\n\t\tthis.universe,\r\n\t\tBuffer([ENTTEC_PRO_END_OF_MSG])\r\n\t])\r\n\tconsole.log(\"in driver message: \" + JSON.stringify(msg));\r\n\tthis.dev.write(msg)\r\n}\r\n\r\nDMX.prototype.start = function() {console.log(\"in driver, start\");}\r\nDMX.prototype.stop = function() {console.log(\"in driver, stop\");}\r\n\r\nDMX.prototype.close = function(cb) {\r\n\tthis.dev.close(cb)\r\n\tconsole.log(\"in driver, close dev\");\r\n}\r\n\r\nDMX.prototype.updateDMX = function(u) {\r\n\tconsole.log(\"in enttec update what is u: \" + JSON.stringify(u));\r\n\tfor(var c in u) {\r\n\t\tthis.universe[c] = u[c]\r\n\t\tconsole.log(\"c: \" + c + \" u: \" + JSON.stringify(u));\r\n\t}\r\n\tconsole.log(\"update enttec this.universe: \" + JSON.stringify(this.universe));\r\n\tthis.send_universe()\r\n}\r\n\r\nDMX.prototype.updateAllDMX = function(v){\r\n\tfor(var i = 0; i < 512; i++) {\r\n\t\tthis.universe[i] = v\r\n\t}\r\n\tthis.send_universe()\r\n}\r\n\r\nDMX.prototype.get = function(c) {\r\n\treturn this.universe[c]\r\n}\r\n\r\nmodule.exports = DMX\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/dmx_usb_pro.js"],"sourceRoot":""}